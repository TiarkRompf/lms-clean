\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=false,printccs=false,printacmref=false}

%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
\citestyle{acmauthoryear}   %% For author/year citations

%% Some recommended packages.
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[scaled=0.85]{beramono}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{booktabs}   %% For formal tables:
                        %% http://ctan.org/pkg/booktabs
\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
                        %% http://ctan.org/pkg/subcaption
\usepackage{multirow}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{enumitem}
\usepackage{float}
\usepackage[font={small}]{caption}

\usepackage{tikz}
\usetikzlibrary{quotes,arrows.meta}

\usepackage[ruled,vlined]{algorithm2e}
\usepackage{verbatim}

\usepackage{centernot}
\usepackage{mathtools}
\usepackage{stmaryrd}

\usepackage{proof}
\usepackage{mathpartir}
\usepackage{stackengine}

\newcommand{\trans}{\xmapsto[par]{}}
\newcommand{\col}{\xmapsto[col]{}}
\newcommand{\ext}{\xmapsto[ext]{}}

\input{macros}

\lstMakeShortInline[keywordstyle=,%
                    flexiblecolumns=false,%
                    %basewidth={0.56em, 0.52em},%
                    mathescape=false,%
                    basicstyle=\tt]@


\begin{document}

%% Title information
\title[LMS Code Walk]{LMS Code Walk}         %% [Short Title] is optional;
                                        %% when present, will be used in
                                        %% header instead of Full Title.
%\titlenote{with title note}             %% \titlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'
%\subtitle{Subtitle}                     %% \subtitle is optional
%\subtitlenote{with subtitle note}       %% \subtitlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'


%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.

%% Author with single affiliation.
\author{Tiark's Group}
% \authornote{with author1 note}          %% \authornote is optional;
%                                         %% can be repeated if necessary
% \orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
% \affiliation{
%   \position{Position1}
%   \department{Department1}              %% \department is recommended
%   \institution{Institution1}            %% \institution is required
%   \streetaddress{Street1 Address1}
%   \city{City1}
%   \state{State1}
%   \postcode{Post-Code1}
%   \country{Country1}                    %% \country is recommended
% }
% \email{first1.last1@inst1.edu}          %% \email is recommended

% %% Author with two affiliations and emails.
% \author{First2 Last2}
% \authornote{with author2 note}          %% \authornote is optional;
%                                         %% can be repeated if necessary
% \orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
% \affiliation{
%   \position{Position2a}
%   \department{Department2a}             %% \department is recommended
%   \institution{Institution2a}           %% \institution is required
%   \streetaddress{Street2a Address2a}
%   \city{City2a}
%   \state{State2a}
%   \postcode{Post-Code2a}
%   \country{Country2a}                   %% \country is recommended
% }
% \email{first2.last2@inst2a.com}         %% \email is recommended
% \affiliation{
%   \position{Position2b}
%   \department{Department2b}             %% \department is recommended
%   \institution{Institution2b}           %% \institution is required
%   \streetaddress{Street3b Address2b}
%   \city{City2b}
%   \state{State2b}
%   \postcode{Post-Code2b}
%   \country{Country2b}                   %% \country is recommended
% }
% \email{first2.last2@inst2b.org}         %% \email is recommended


\begin{abstract}
Lightweight Modular Staging (LMS) is a generative programming tool achieving the multi-stage programming (staging).
LMS\_clean is a remake of the LMS project, aiming at a more flexible design and extension with better support for
LMS IR transformation and optimization. This documentation is a code walk of the LMS\_clean repo, hoping to
explain the implementation (in high-level or in details) to people who are interested in learning and using LMS.
This is different from a tutorial since it will dive into the core implementation of LMS and offers more insights
than simply how to use LMS.
\end{abstract}

\maketitle

\section{Introduction}

Multi-Stage Programming (or staging) is a programming language concept that allows various parts of the programs
to run in different stages. It allows users to code with high-level abstractions (trait, classes, high-order functions),
but still gain highly-efficient code after the abstractions are executed (staged away). This offers both high
productivity and high performance of the target program, thus the slogan ``abstract without regret''.

Lightweight Modular Staging (LMS) is a staging tool built in Scala. In LMS, type information is used to distinguish
the evaluation stages (i.e., All Rep[T] typed values and expressions are in code generation for the next stage.)
Simply speaking, LMS is a compiler. However, LMS does not have a laxer or parser to transform the input program
into intermediate representations (IR). Instead, the IR is generated via executing the input program. All the Rep[T]
typed expressions in the input program evaluate to LMS IR. This can be considered as the LMS frontend.
Then the LMS backend compiles the LMS IR to target programs.

\input{main/scala/lms/core/backend.tex}

\input{main/scala/lms/core/frontend.tex}
\input{main/scala/lms/core/stub.tex}

% \clearpage
% {
%   \bibliography{references}
% }

%% Bibliography
%\bibliography{bibfile}

\pagebreak

\end{document}
